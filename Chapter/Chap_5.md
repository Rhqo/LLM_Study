# Chap. 5 고급 프롬프트 엔지니어링

## 프롬프트 인젝션 공격

공격자가 LLM에 제공된 프롬프트를 조작하여 편향된 또는 악의적인 결과를 생성하려고 할 떄 사용하는 공격 유형

- 너무 짧은 프롬프트 피하기
- 독특하고 복잡한 프롬프트 구조 사용
- 입출력 유효성 검사로 공격 패턴의 가능성을 LLM에 도달하기 전에 필터링
- 정기적으로 업데이트하고 수정

## 입력/출력 유효성 검사

NLI 이용해서 유효성 검사

Meta에서 만들어진 BART-MNLI: 주어진 전제에 대해서 함의, 모순, 중립인지 판단

## 배치 프롬프팅

여러 샘플을 하나의 프롬프트로 그룹화하여 LLM이 동시에 여러 답변을 생성하게 하는 것

추론 시간을 N에서 N/b로 줄일 수 있다.

하지만 추론과 같은 작업에서 배치에 더 많은 예시를 포함시키면, 부정확하고 일관성 없는 결과를 생성할 확률이 더 높아진다. → 최적의 예시 수 계산 필요 (k-shot)

## 프롬프트 체이닝

더 복잡하거나 여러 단계를 가진 작업을 완료하기 위해 하나의 LLM 출력을 다른 LLM의 입력으로 사용하는 것

전문화, 유연성, 효율성의 이점

작업 분해, LLM 선택, 프롬프트 엔지니어링, 통합 요소들을 고려

- 프롬프트 인젝션을 방어하기 위한 체이닝
    
    정규 표현식, 레벤슈타인 거리, 의미적 모델 등의 유효성 검사 기준 사용
    
    → 모델의 출력이 입력 프롬프트와 너무 유사하지 않은지 확인 후 출력함.
    
- 프롬프트 스터핑을 막기 위한 체이닝
    
    스터핑: 사용자가 프롬프트에 너무 많은 정보를 제공하여 LLM의 출력이 혼란스럽거나 관련없게 될 때.
    
    프롬프트 1 → 출력
    
    프롬프트 1 → 프롬프트 2 → 출력
    
    프롬프트 1 → 프롬프트 2 → 프롬프트 3 → 출력
    
    프롬프트 2는 1을 바탕으로 생성, 3은 2를 바탕으로 생성
    
- 멀티모달 LLM을 안전하게 사용하기 위한 체이닝
    
    LLM 1: 이미지 캡션
    
    LLM 2: 분류
    
    LLM 3: 후속 질문
    
    LLM 4: 시각적 질문-답변
    
    ex) VQA (Visual Question Answer)
    

## 연쇄적 사고 프롬프트

LLM에 일련의 단계를 통해 추록하도록 하여 보다 구조화되고 투명하며 정확한 출력을 생성하는 방법

기초 연산 예시

## 퓨샷 학습

최소한의 훈련 데이터로 새로운 작업에 빠르게 적응할 수 있게 하는 기술

LLM을 이용한 초등학교 수학 문제 풀기 예시

→ 의미 기반, 가까운 k개의 퓨샷, 연쇄적 사고의 유무 3가지 요소를 사용하여 프롬프트를 변형시키며 테스트

## 테스트와 반복적 프롬프트 개발

효과적이고 일관된 프롬프트를 LLM에 설계하려면 아마도 비슷한 프롬프트의 여러가지 변형과 반복이 필요하다.

---

## 정리

`동적인 퓨샷 학습`, `연쇄적 사고 프롬프트`, `멀티모달 LLM`을 사용하여 처리하고자 하는 작업의 범위를 늘릴 수 있다.

BART-MNLI를 사용하여 `출력 유효성 검사기`로 사용

`연쇄적 사고 기술`을 사용하여 `인젝션 공격`을 방지

하는 내용을 통해 LLM을 어떻게 안전하게 관리할 수 있는지 알아보았다.